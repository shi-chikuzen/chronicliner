<!DOCTYPE html>
<!-- Copyright (c) 2022 @shi_chikuzen-->
<html lang="ja" dir="ltr" id="html">
    <head>
        <meta charset="utf-8">
        <!-- Vuetify CDN Settings -->
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
        <!-- SheetJS CDN Settings -->
        <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
        <!-- Font -->
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Unica+One&display=swap" rel="stylesheet">
        <!-- Sourse -->
        <link rel="stylesheet" href="./css/app.css">

        <title>Chronicliner2</title>
    </head>
    <body>
        <div id="app">
            <v-app>
                <!-- Application Bar -->
                <v-app-bar
                app
                absolute
                class="px-10"
                style="border-bottom: 1px solid #eaf1f5 !important;"
                color="white"
                elevation="0">
                    <v-toolbar-title class="font logo">Chronicliner</v-toolbar-title>
                    <v-spacer></v-spacer>
                    <!-- File Form -->
                    <v-form>
                        <v-file-input
                        v-model="fileSelected"
                        @change="readFile"
                        accept=".xlsx"
                        label="Select File..."
                        hide-input
                        prepend-icon="mdi-folder-table-outline"
                        ></v-file-input>
                    </v-form>
                    <!-- ファイル追加時chipをアニメーションで表示 -->
                    <v-expand-x-transition>
                        <v-chip
                        v-show="this.state.ready"
                        v-if="this.fileSelected != null"
                        :color="this.state.fileError? 'error' : 'success'"
                        outlined>
                            {{this.fileSelected.name}}
                        </v-chip>
                    </v-expand-x-transition>
                </v-app-bar>
                <!-- Contents -->
                <v-main id="main">
                    <v-container fluid>
                        <v-row class="px-3">
                            <!-- Select Field -->
                            <v-col cols="12">
                                <v-expansion-panels accordion>
                                    <v-expansion-panel
                                    elevation="1">
                                        <v-expansion-panel-header class="size line-height">
                                            表示設定
                                        </v-expansion-panel-header>
                                        <v-expansion-panel-content>
                                            <v-tabs
                                            vertical
                                            v-show="this.state.ready">
                                                <v-tab
                                                v-for="(value, name) in this.data.settings.category">
                                                    {{name}}
                                                </v-tab>
                                                <v-tab-item
                                                v-for="(value, name) in this.data.settings.category">
                                                    <v-card flat>
                                                        <v-card-text>
                                                            <v-row class="py-0">
                                                                <v-col class="py-0">
                                                                    <v-btn text @click="selectAllCharactersInCategory(name)">
                                                                        すべて選択
                                                                    </v-btn>
                                                                    <v-btn text @click="removeAllCharactersInCategory(name)">
                                                                        すべて選択解除
                                                                    </v-btn>
                                                                </v-col>
                                                            </v-row>
                                                            <v-row>
                                                                <v-col
                                                                v-for="character in value.characters">
                                                                    <v-checkbox
                                                                    v-model="characterSelected"
                                                                    :label="character"
                                                                    :value="character"
                                                                    ></v-checkbox>
                                                                </v-col>
                                                            </v-row>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-tab-item>
                                            </v-tabs>
                                        </v-expansion-panel-content>
                                    </v-expansion-panel>
                                </v-expansion-panels>
                            </v-col>
                            <!-- Contents Field -->
                            <v-col cols="12">
                                <v-card
                                elevation="1"
                                :loading="this.state.loading"
                                :class="(this.state.ready) ? 'pb-4' : ''">
                                    <v-card-title class="px-6 size">
                                        年表
                                    </v-card-title>
                                    <v-card-text class="px-6">
                                        <v-expand-transition>
                                            <v-timeline
                                            align-top
                                            dense
                                            v-show="this.state.ready">
                                                <!-- Timeline -->
                                                <v-timeline-item
                                                v-for="key in eventKeys"
                                                :set="event = data.event[key]"
                                                v-show="intersection(data.event[key].characters, characterSelected).length > 0"
                                                small
                                                right
                                                fill-dot>
                                                    <span slot="opposite">
                                                        <span
                                                        class="font-weight-bold font"
                                                        style="font-size:1.1rem !important;"
                                                        v-show="isFirstEvent(key)">
                                                            {{event.date.getFullYear()}}<br>
                                                        </span>
                                                        <span
                                                        v-if="defaults.displayLimit[data.event[key].limit] >= defaults.displayLimit.day"
                                                        style="font-size:1.0rem !important;"
                                                        class="font f-black">
                                                            {{event.date.getMonth()+1}}
                                                        </span>
                                                        <span
                                                        v-if="defaults.displayLimit[data.event[key].limit] >= defaults.displayLimit.hour"
                                                        style="font-size:1.0rem !important;"
                                                        class="font f-black">
                                                            /&nbsp;{{event.date.getDate()}}
                                                        </span>
                                                        <span
                                                        v-if="defaults.displayLimit[data.event[key].limit] >= defaults.displayLimit.minute"
                                                        style="font-size:1.0rem !important;"
                                                        class="font f-black">
                                                            <br>{{fillTimeByZero(event.date.getHours())}}
                                                        </span>
                                                        <span
                                                        v-show="defaults.displayLimit[data.event[key].limit] >= defaults.displayLimit.minute"
                                                        style="font-size:1.0rem !important;"
                                                        class="font f-black">
                                                            :&nbsp;{{fillTimeByZero(event.date.getMinutes())}}
                                                        </span>
                                                    </span>
                                                    <v-card outlined>
                                                        <v-card-text class="white text--primary">
                                                            <!-- ALL -->
                                                            <v-row v-if="event.events.all.length > 0">
                                                                <v-col class="pb-0">
                                                                    <v-tooltip
                                                                    bottom
                                                                    v-for="(e, i) in event.events.all"
                                                                    >
                                                                        <template v-slot:activator="{ on, attrs }">
                                                                            <v-chip 
                                                                            label
                                                                            v-bind:class="[(i+1 != event.events.all.length) ? 'mr-2' : '']"
                                                                            v-bind="attrs"
                                                                            v-on="on"
                                                                            color="grey darken-3"
                                                                            text-color="white"
                                                                            >
                                                                                <v-icon left>
                                                                                    mdi-alpha-a-box
                                                                                </v-icon>
                                                                                {{e.title}}
                                                                            </v-chip>
                                                                        </template>
                                                                        <span v-if="e.detail != ''">
                                                                            {{e.detail}}
                                                                        </span>
                                                                    </v-tooltip>
                                                                </v-col>
                                                            </v-row>
                                                            <!-- Character -->
                                                            <v-row>
                                                                <v-col
                                                                class="overflow-x-auto d-flex align-stretch"
                                                                v-for="c in data.settings.category">
                                                                    {{c}}
                                                                </v-col>
                                                            </v-row>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-timeline-item>
                                            </v-timeline>
                                        </v-expand-transition>
                                    </v-card-text>
                                </v-card>
                            </v-col>
                        </v-row>
                    </v-container>
                </v-main>
                <v-snackbar
                v-model="this.state.errorSnack"
                timeout=5000>
                    <span v-html="this.snackMessage"></span>
                    <template v-slot:action="{attrs}">
                        <v-btn
                        color="primary"
                        text
                        v-bind="attrs"
                        v-on:click="state.errorSnack = false;">
                            Close
                        </v-btn>
                    </template>
                </v-snackbar>
            </v-app>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
        <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
        <script type="text/javascript" src="./js/app.js"></script>
    </body>
</html>